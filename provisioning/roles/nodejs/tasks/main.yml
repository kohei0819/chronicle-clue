---
- name: Add NodeSource key information to apt
  apt_key: url=https://deb.nodesource.com/gpgkey/nodesource.gpg.key

- name: Add package download source to apt
  copy:
    content: |
      deb https://deb.nodesource.com/node_13.x xenial main
      deb-src https://deb.nodesource.com/node_13.x xenial main
    dest: /etc/apt/sources.list.d/nodesource.list
  register: sources_list

- name: Update apt
  apt: 
    update_cache: yes
  when: sources_list is changed

- name: Add Yarn repository to apt
  become: yes
  become_user: root
  shell: |
    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
    echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
    apt update

- name: Install packages
  apt:
    force: yes
    name:
      - nodejs
      - yarn
      - build-essential
